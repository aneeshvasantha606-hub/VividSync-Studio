<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vividsync Studio | Admin Dashboard</title>
  <style>
    /* =========================================================
   âœ¨ Vividsync Studio | Admin Dashboard Theme
   Dark Aurora UI | Neon Glow Accent | Smooth Animations
========================================================= */
body {
  background: radial-gradient(circle at top left, #0a192f, #0f172a);
  color: #e2e8f0;
  font-family: "Poppins", sans-serif;
  margin: 0;
  padding: 40px;
  transition: 0.4s ease;
}

/* ---------- HEADER ---------- */
h1 {
  text-align: center;
  color: #00ffff;
  text-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
  margin-bottom: 30px;
  letter-spacing: 1px;
  animation: fadeIn 0.8s ease;
}

/* ---------- LOGIN CONTAINER ---------- */
.login-container {
  max-width: 400px;
  margin: 120px auto;
  padding: 40px;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.2);
  text-align: center;
  animation: fadeInUp 0.6s ease forwards;
}

.login-container h2 {
  margin-bottom: 20px;
  color: #00ffff;
  text-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
}

/* ---------- INPUTS ---------- */
input {
  width: 100%;
  margin-bottom: 15px;
  padding: 12px 15px;
  border: none;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.1);
  color: #e2e8f0;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
}

input:focus {
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
}

input::placeholder {
  color: #94a3b8;
}

/* ---------- BUTTONS ---------- */
button {
  background: linear-gradient(135deg, #00ffff, #00bcd4);
  border: none;
  padding: 10px 18px;
  color: #0f172a;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  letter-spacing: 0.6px;
  transition: 0.3s ease-in-out;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

/* Specialized Buttons */
#exportExcelBtn {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: #fff;
}

#exportPdfBtn {
  background: linear-gradient(135deg, #ff66b2, #ff2d75);
  color: #fff;
}

#exportPdfBtn:hover {
  box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
}

#logoutBtn {
  background: linear-gradient(135deg, #ff416c, #ff4b2b);
  color: #fff;
}

#logoutBtn:hover {
  box-shadow: 0 0 20px rgba(255, 99, 71, 0.5);
}

/* ---------- LABEL ---------- */
label {
  display: flex;
  align-items: center;
  justify-content: start;
  font-size: 0.9rem;
  color: #94a3b8;
  margin-bottom: 20px;
}

label input {
  width: auto;
  margin-right: 8px;
}

/* ---------- DASHBOARD CONTAINER ---------- */
.dashboard {
  display: none;
  background: rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(10px);
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 35px rgba(0, 255, 255, 0.2);
  animation: fadeInUp 0.6s ease forwards;
}

/* ---------- CONTROLS ---------- */
.controls {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 15px;
  gap: 10px;
}

/* ---------- TABLE ---------- */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 0.95rem;
}

th,
td {
  border-bottom: 1px solid rgba(255, 255, 255, 0.15);
  padding: 10px 12px;
  text-align: left;
}

th {
  background: rgba(0, 255, 255, 0.1);
  color: #00ffff;
  text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
}

tr:hover {
  background-color: rgba(255, 255, 255, 0.08);
  transition: 0.2s;
}

td button {
  background: linear-gradient(135deg, #ff416c, #ff4b2b);
  padding: 6px 10px;
  font-size: 0.9rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: white;
  transition: 0.3s;
}

td button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(255, 99, 71, 0.5);
}

/* ---------- ANIMATIONS ---------- */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 700px) {
  table,
  th,
  td {
    font-size: 0.8rem;
  }

  h1 {
    font-size: 1.3rem;
  }

  .login-container {
    margin: 80px 20px;
    padding: 30px;
  }
}
  </style>
</head>
<body>

  <h1>VividSync Studio Admin Panel</h1>

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-container">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username" required />
    <input type="password" id="password" placeholder="Password" required />
    <label>
      <input type="checkbox" id="rememberMe" /> Remember Me
    </label>
    <button id="loginBtn">Login</button>
    <p id="loginError" style="color: #ff80c0; margin-top: 10px;"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="dashboard">
    <div class="controls">
      <input type="text" id="search" placeholder="ðŸ” Search by name or service" />
      <div>
  <button id="refreshBtn">ðŸ”„ Refresh</button>
  <button id="exportExcelBtn">ðŸ“Š Export Excel</button>
  <button id="exportPdfBtn">ðŸ§¾ Export PDF</button>
  <button id="clearAllBtn">ðŸ§¹ Clear All</button>
  <button id="logoutBtn">ðŸšª Logout</button>
</div>

    </div>

    <table id="dataTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Booking Type</th>
          <th>Service</th>
          <th>Message</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // --- Simple Admin Credentials ---
    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "vividsync@2025";

    const loginPage = document.getElementById("loginPage");
    const dashboard = document.getElementById("dashboard");

    function showDashboard() {
      loginPage.style.display = "none";
      dashboard.style.display = "block";
      renderTable();
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      location.reload();
    }

    document.getElementById("logoutBtn").addEventListener("click", logout);

    document.getElementById("loginBtn").addEventListener("click", () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const remember = document.getElementById("rememberMe").checked;
      const error = document.getElementById("loginError");

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        if (remember) localStorage.setItem("loggedIn", "true");
        showDashboard();
      } else {
        error.textContent = "âŒ Invalid username or password!";
      }
    });

    if (localStorage.getItem("loggedIn") === "true") {
      showDashboard();
    }

    // --- Fetch and render data ---
    async function fetchData() {
      const res = await fetch("http://localhost:5000/api/enquiries");
      return await res.json();
    }

    async function renderTable() {
      const data = await fetchData();
      const searchValue = document.getElementById("search").value.toLowerCase();
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";

      data
        .filter(item =>
          item.name.toLowerCase().includes(searchValue) ||
          item.service.toLowerCase().includes(searchValue) ||
          item.bookingType.toLowerCase().includes(searchValue)
        )
        .forEach(item => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.email}</td>
            <td>${item.bookingType}</td>
            <td>${item.service}</td>
            <td>${item.message}</td>
            <td>${new Date(item.date).toLocaleString()}</td>
            <td><button onclick="deleteEntry(${item.id})">Delete</button></td>
          `;
          tbody.appendChild(row);
        });
    }

    async function deleteEntry(id) {
      if (!confirm("Delete this entry?")) return;
      await fetch(`http://localhost:5000/api/enquiries/${id}`, { method: "DELETE" });
      renderTable();
    }

    async function clearAll() {
      if (!confirm("âš ï¸ This will delete all entries! Continue?")) return;
      await fetch("http://localhost:5000/api/enquiries", { method: "DELETE" });
      renderTable();
    }
    // ---------------- EXPORT FUNCTIONS ----------------

// ðŸ“Š Export to Excel
async function exportToExcel() {
  const data = await fetchData();
  if (!data.length) { 
    alert("No data available to export!");
    return;
  }

  // Format data for Excel
  const formattedData = data.map(item => ({
    Name: item.name,
    Email: item.email,
    "Booking Type": item.bookingType,
    Service: item.service,
    Message: item.message,
    Date: new Date(item.date).toLocaleString()
  }));

  const ws = XLSX.utils.json_to_sheet(formattedData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Enquiries");

  XLSX.writeFile(wb, "Vividsync_Enquiries.xlsx");
}

// ðŸ§¾ Export to PDF (Styled Table)
async function exportToPDF() {
  const data = await fetchData();
  if (!data.length) {
    showPopup("âš ï¸ No data available to export!", "error");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });

  // Header Styling
  doc.setFontSize(20);
  doc.setTextColor(30, 30, 30);
  doc.text("Vividsync Studio - Client Enquiries", 14, 20);
  doc.setFontSize(11);
  doc.setTextColor(100);
  doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 28);

  // Table Headers
  const headers = [
    ["Name", "Email", "Booking Type", "Service", "Message", "Date"]
  ];

  // Table Data
  const rows = data.map(item => [
    item.name,
    item.email,
    item.bookingType,
    item.service,
    item.message,
    new Date(item.date).toLocaleString()
  ]);

  // Table
  doc.autoTable({
    startY: 35,
    head: headers,
    body: rows,
    styles: {
      fontSize: 9,
      cellPadding: 3,
      overflow: "linebreak",
      lineColor: [220, 220, 220],
      lineWidth: 0.1,
    },
    headStyles: {
      fillColor: [255, 20, 147], // pink header
      textColor: 255,
      fontStyle: "bold",
    },
    alternateRowStyles: { fillColor: [255, 240, 245] },
    margin: { top: 10, bottom: 10 },
  });

  // Footer
  const pageCount = doc.internal.getNumberOfPages();
  for (let i = 1; i <= pageCount; i++) {
    doc.setPage(i);
    doc.setFontSize(9);
    doc.setTextColor(150);
    doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
  }

  // Save File
  doc.save("Vividsync_Enquiries_Report.pdf");

  showPopup("âœ… PDF exported successfully!", "success");
}

// Bind buttons
document.getElementById("exportExcelBtn").addEventListener("click", exportToExcel);
document.getElementById("exportPdfBtn").addEventListener("click", exportToPDF);

    document.getElementById("refreshBtn").addEventListener("click", renderTable);
    document.getElementById("clearAllBtn").addEventListener("click", clearAll);
    document.getElementById("search").addEventListener("input", renderTable);

    // Auto refresh every 10s
    setInterval(() => {
      if (dashboard.style.display === "block") renderTable();
    }, 10000);
  </script>
  <!-- Excel Export Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- PDF Export Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

</body>
</html>
